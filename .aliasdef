#!/bin/bash

# Sæt hjem
hjem=$(pwd)/pirathavn

hjælp() {
    glow $hjem/.hjælp.md
}

merehjælp() {
    glow $hjem/.merehjælp.md
}

start() {
    clear
    cd $hjem
    glow .intro.md
}

# Opgaverækkefølge
export pape=0
export lager=0
export gemmested=0
export gemtbesked=0
export piratflag=0
export abe=0
export guldkiste=0
export unicorn=0

opgave_array=(	"klare papegøjen på pirathavnen"
		"åbne kisterne i lageret på vestmolen"
		"hjælpe redningstjenesten på østmolen"
		"finde kaptajnens gemte besked på skattekortet i piratbaren på østmolen"
		"finde koden hos kartografen på vestmolen"
		"snakke med den trehovedede abe i piratbaren på østmolen"
		"åbne guldkisten i skibsværftet"
		"åbne simon milfreds kiste i vaskeriet"
		)

hvadnu() {
	opgave=1
	if [[ $pape = 1 ]]; then
	  	opgave=$((opgave+1))
	  	if [[ $lager = 1 ]]; then
	    		opgave=$((opgave+1))
	    		if [[ $gemmested = 1 ]]; then
	      			opgave=$((opgave+1))
				if [[ $gemtbesked = 1 ]]; then
					opgave=$((opgave+1))
					if [[ $piratflag = 1 ]]; then
		  				opgave=$((opgave+1))
						if [[ $abe = 1 ]]; then
							opgave=$((opgave+1))
							if [[ $guldkiste = 1 ]]; then
								opgave=$((opgave+1))
								if [[ $unicorn = 1 ]]; then
									opgave=$((opgave+1))
									echo "Du er klar til at komme ombord på piratskibet!"
									exit 0
			                    			fi
			                    		fi
		  				fi
					fi
				fi
			fi
	  	fi
	fi
	echo -e "# Næste udfordring\n - Du skal ${opgave_array[$opgave]}"|glow
}

cd() {
    if [[ "$@" == *"piratskibet" ]] || [[ "$@" == *"piratskibet/" ]]; then
	if [[ "$(hvadnu)" == "Du er klar til at komme ombord på piratskibet!" ]]; then
		export starttime=$(cat $hjem/.starttime)
		export endtime=$(date +%s)
		export duration=$(($endtime - $starttime))
		echo
		echo "Whoaa! Tillykke du er kommet ombord! Det tog dig $(date -d@$duration -u +%H:%M:%S)."
		echo 
		echo "Rejs dig op og sig AAAARH!"
		echo
		builtin cd "$@"
	else
		echo -e "# Du er ikke klar til at komme ombord!\n$(hvadnu)"|glow
	fi
    elif [[ "$@" == "gemmested" ]] || [[ "$@" == "gemmested/" ]]; then
        echo '
Fedt du slap væk..!

Husk at lave variablen gemmested=1 med:
export gemmested=1'
    elif [[ -d pirathavn ]] && [[ "$@" == "pirathavn" ]] || [[ "$@" == "pirathavn/" ]]; then
	echo $(date +%s)>$hjem/.starttime
	echo
	echo "Velkommen til pirathavnen, tjek omgivelserne med: cat pirathavn"
	echo
	builtin cd "$@"
    else
        builtin cd "$@"
    fi
}

echo() {
	if [[ "$@" == "Skattekortet er begravet på øen Isolering" ]]; then
		builtin echo "$@"
		builtin echo 
		builtin echo "Hoved 2: Arrrh nej, det var ikke Isolering, men Loddetin - skriv det pirataspirant!"
		builtin echo
	elif [[ "$@" == "Skattekortet er begravet på øen Loddetin" ]]; then
		builtin echo
		builtin echo "Hoved 1: Fjumrehoveder! Det var da slet ikke en skat! Skriv i stedet: Skattekortet er blevet væk"
		builtin echo
	elif [[ "$@" == "Skattekortet er blevet væk" ]]; then
		builtin echo
		builtin echo -e "Du træder lidt væk, da abens tre hoveder begynder at råbe og skrige og bide efter hinanden.\n\nKort efter løber aben ud af døren."
		builtin echo
		builtin echo -e "Du kan nu sætte variablen abe til 1 med kommandoen:\n\nexport abe=1"
		builtin echo 
		builtin echo -e "# BoboCocoLoco\nLiget af den trehovedede abe ligger og det er et skræmmende og foruroligende syn. Dens tre hoveder er kastet tilbage i en uhyggelig vrangstilling, med åbne munde, der stadig ser ud til at råbe og skænde, selv i døden. Øjnene er udtværet i en skræmmende grimasse af smerte, og den kolde havbrise får dens pels til at bølge som spøgelsesagtige skygger.\n\nDe omkringliggende måger er tavse og er flygtet væk. Stilheden er kun afbrudt af de dystre bølgers sagte klukken. Det er som om, østmolen selv bærer ar fra den trehovedede abes gruopvækkende død, og det sender en kuldegysning ned ad ryggen på enhver, der tør nærme sig.\n\n">$hjem/østmolen/trehovedetabe.md
		rm trehovedetabe.md
	elif [[ "$@" == "Skatteko"* ]]; then
		builtin echo
		builtin echo "Hoved $((1 + $RANDOM % 3)): Aaaarh! Prøv igen!"
		builtin echo 
	else
		builtin echo "$@"
	fi
}

alias piratflag='echo -e "# Sådan matroser....\n\n###I har nu fuldført denne opgave og kan gå videre. Må vinden altid være i jeres sejl, og må skattejagterne aldrig ende!\n\nLykke og held! 🏴‍☠️💰\n\nSkriv \`export piratflag=1\` så gemmer du dine fremskridt.\n\nDu kan tjekke om dine fremskridt er gemt med \`echo \$piratflag\`" | glow'

.check_ip.sh > /dev/null 2>&1 &