#!/bin/bash

export gemtbesked=0
export pape=0

# Sæt hjem
hjem=$(pwd)/pirathavn

hjælp() {
    glow $hjem/.intro.md
}

start() {
    clear
    cd $hjem
    glow .intro.md
}

cd() {
    if [[ "$@" == *"piratskibet"* ]]; then
	if [[ $gemtbesked = 0 ]]; then
		echo
	        echo "Kaptajnen vil have du finder beskeden før du kommer ombord"
		echo
	elif [[ $gemtbesked = 1 ]] && [[ $pape = 0 ]]; then
		echo
		echo "Du må besejre den skeløjede papegøje"
		echo
	elif [[ $gemtbesked = 1 ]] && [[ $pape = 1 ]] && [[ $abe = 0 ]]; then
		echo
		echo "Du skal snakke med den trehovedede abe på piratbaren"
		echo
	elif [[ $gemtbesked = 1 ]] && [[ $pape = 1 ]] && [[ $abe = 1 ]]; then
		export starttime=$(cat $hjem/.starttime)
		export endtime=$(date +%s)
		export duration=$(($endtime - $starttime))
		echo
		echo "Whoaa! Tillykke du er kommet ombord! Det tog dig $(date -d@$duration -u +%H:%M:%S)."
		echo 
		echo "Rejs dig op og sig AAAARH!"
		echo
		builtin cd "$@"
	fi
    elif [[ $@ == "gemmested" ]] || [[ $@ == "gemmested/" ]]; then
        echo "Fedt du slap væk..!"
    elif [[ -d pirathavn ]] && [[ $@ == "pirathavn" ]] || [[ $@ == "pirathavn/" ]]; then
	echo $(date +%s)>$hjem/.starttime
	echo
	echo "Velkommen til pirathavnen, tjek omgivelserne med: cat pirathavn"
	echo
	builtin cd "$@"
    else
        builtin cd "$@"
    fi
}

echo() {
	if [[ "$@" == "Skattekortet er begravet på øen Isolering" ]]; then
		builtin echo "$@"
		builtin echo 
		builtin echo "Hoved 2: Arrrh nej, det var ikke Isolering, men Loddetin - skriv det pirataspirant!"
		builtin echo
	elif [[ "$@" == "Skattekortet er begravet på øen Loddetin" ]]; then
		builtin echo
		builtin echo "Hoved 1: Fjumrehoveder! Det var da slet ikke en skat! Skriv i stedet: Skattekortet er blevet væk"
		builtin echo
	elif [[ "$@" == "Skattekortet er blevet væk" ]]; then
		builtin echo
		builtin echo -e "Du træder lidt væk, da abens tre hoveder begynder at råbe og skrige og bide efter hinanden.\n\nKort efter løber aben ud af døren."
		builtin echo
		builtin echo -e "Du kan nu sætte variablen abe til 1 med kommandoen:\n\nexport abe=1"
		builtin echo 
		builtin echo -e "# BoboCocoLoco\nLiget af den trehovedede abe ligger og det er et skræmmende og foruroligende syn. Dens tre hoveder er kastet tilbage i en uhyggelig vrangstilling, med åbne munde, der stadig ser ud til at råbe og skænde, selv i døden. Øjnene er udtværet i en skræmmende grimasse af smerte, og den kolde havbrise får dens pels til at bølge som spøgelsesagtige skygger.\n\nDe omkringliggende måger er tavse og er flygtet væk. Stilheden er kun afbrudt af de dystre bølgers sagte klukken. Det er som om, østmolen selv bærer ar fra den trehovedede abes gruopvækkende død, og det sender en kuldegysning ned ad ryggen på enhver, der tør nærme sig.\n\n">$hjem/østmolen/trehovedetabe.md
		rm trehovedetabe.md
	elif [[ "$@" == "Skatteko"* ]]; then
		builtin echo
		builtin echo "Hoved $((1 + $RANDOM % 3)): Aaaarh! Prøv igen!"
		builtin echo 
	else
		builtin echo "$@"
	fi
}

alias piratflag='echo "# Sådan matroser....\n\n###I har nu fuldført denne opgave og kan gå videre. Må vinden altid være i jeres sejl, og må skattejagterne aldrig ende!\n\nLykke og held! 🏴‍☠️💰" | glow .næste_opgave.md'
